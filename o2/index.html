<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Simple sample - gin samples</title>
</head>
<body>
<div id="device"></div>
<script type="text/javascript" src="gin.js"></script>
<!--script type="text/javascript" src="../3rd-party/webgl-2d.js"></script-->
<script type="text/javascript">
$G('device', {
    width: 400,
    height: 400
}, {
    start: function() {
        this.data('rad', 2 * Math.random())
        .data('radDelta', -0.004)
        .data('color', 0)
        .data('keyLightHeight', 10)
        .data('singleNoteHeight', 6)
        .data('notesHeight',   [0, -20, -140, -180, -250, -260, -320])
        .data('notesPosition', [3, 6,   1,    5,    4,    2,    1])
        .data('deltaHeight', 0)
        .data('colorDelta', 8);
    },
    render: function(e) {
        var keySettings = [0x53, 0x44, 0x46, 0x20, 0x4a, 0x4b, 0x4c]; //'d', 'f', 'g', ' ', 'j', 'k', 'l' 
        var ctx = e.context,
            rad = this.data('rad'),
            radDelta = this.data('radDelta'),
            color = this.data('color'),
            keyLightHeight = this.data('keyLightHeight'),
            singleNoteHeight = this.data('singleNoteHeight'),
            notesHeight = this.data('notesHeight'),
            notesPosition = this.data('notesPosition'),
            deltaHeight = this.data('deltaHeight'),
            colorDelta = this.data('colorDelta'),
            r = rad * Math.PI;
        
        ctx.save();
        ctx.clearRect(0, 0, this.width(), this.height());
        ctx.beginPath();
        ctx.lineWidth = 20;
        ctx.strokeStyle = 'rgb(255,' + color + ',' + color + ')';
        ctx.moveTo(100, 100);
        ctx.lineTo(100 + Math.cos(r) * 80, 100 + Math.sin(r) * 80);
        ctx.arc(100, 100, 80, r, r + 5/3 * Math.PI, false);
       
        blockSize = keySettings.length;
        blockWidth = this.width() / blockSize;
        for (var i=0; i<blockSize; i++) {
          keyCode = keySettings[i];
          if (e.keyState[keyCode]) {
            ctx.fillRect(i*blockWidth, this.width() - keyLightHeight, blockWidth, keyLightHeight);
          }
	}
	var str = JSON.stringify(e.keyState);
	if (str != '{}')
	console.log(JSON.stringify(e.keyState));
        for (var i=0; i<notesHeight.length; i++) {
          height = notesHeight[i] + deltaHeight;
          if (height > 0 && height + singleNoteHeight <= this.height()) {
            ctx.fillRect(blockWidth*notesPosition[i], height, blockWidth, singleNoteHeight);
          }
        }
        ctx.stroke();
        ctx.restore();
        
        color += colorDelta;
        rad += radDelta;
        this.data('rad', rad)
        .data('radDelta', rad >= 2 || rad <= 0? -radDelta: radDelta)
        .data('color', color)
        .data('deltaHeight', (deltaHeight + 5)%640)
        .data('colorDelta', color >= 200 || color <= 0? -colorDelta: colorDelta);
    }
})
;

</script>
</body>
</html>
